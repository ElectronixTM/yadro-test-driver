# Yadro test driver

## Сборка и установка

Все компоненты модуля находятся в директории src. В нем же находится Makefile для сборки. Данный драйвер написан для дистрибутива Debian 12 на базе ядра линукс 6.1.0-34.

Сборку можно произвести перейдя в директорию src и выполнив команду `make`. Загрузить модуль можно при помощи команды `insmod dmp.ko` с соответствующей процедурой выгрузки `rmmod dmp`.

## Тестирование

После сборки и загрузки модуля появится возможность создавать устройства типа dmp при помощи команд вроде:

```bash
dmsetup create dmp1 --table "0 $size dmp /dev/mapper/zero1"
```

Создать экзмемпляр прокси можно, например, следующими комнадами

```bash
dmsetup create zero1 --table "0 $size zero"
dmsetup create dmp1 --table "0 $size dmp /dev/mapper/zero1"
```

После этих действий в директории `/dev/mapper` должы появиться устройства `zero1` и `dmp1`

Далее, используя команду dd, можно писать в dmp1 и читать оттуда, фактически взаимодействуя с ниже лежащим девайсом

```bash
dd if=/dev/random of=/dev/mapper/dmp1 bs=4k count=1
dd if=/dev/mapper/dmp1 of=/tmp/output bs=4k count=1
```

Посмотреть статистику в отформатированном виде можно в sysfs, например, следующей командой:

```bash
cat /sys/module/dmp/stat/volumes
```

Эта команда выведет совокупную статистику от всех прокси, работающих на данный момент (см. раздел комментариев)

## Комментарии

Некоторые вещи из описания показались мне не однозначными, поэтому считаю нужным описать предположения, из которых исходил:

1. В описании задания файл `.../dmp/stat/volumes` только один, хотя прокси создавать можно много. Поскольку после volumes не стоит число, предположил, что файл должен быть один. Исходя из этого, я решил не создавать новый файл на каждое проксируемое устройство, а держать всю статистику по всем прокси в одном файле.
2. Средние значения размеров блоков на чтение и запись могут оказаться дробными, но в рамках модуля они приводятся к целым числам.
3. Насколько можно видеть из описания тестового задания, обращение к файлу через cat генерирует отформатированный вывод. Я реализовал его в том виде, в котором он показан на скриншотах, пусть в [документации](https://www.kernel.org/doc/html/latest/filesystems/sysfs.html#attributes) линукса и рекомендуют выводить только массивы чисел
